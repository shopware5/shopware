(function(){tinymce.create("tinymce.plugins.MediaSelectionPlugin",{ed:null,imageCls:"tinymce-editor-image",linkCls:"tinymce-editor-link",videoCls:"tinymce-editor-video",audioCls:"tinymce-editor-audio",init:function(a,b){var c=this;c.ed=a,a.addCommand("mceMediaSelection",function(){var d=!1;"function"!=typeof Shopware.app.Application.addSubApplication&&Ext.Error.raise({msg:"Your ExtJS application does not support sub applications",option:[a,b]}),c.ed.settings&&c.ed.settings.fullscreen_is_enabled&&(d=!0),Shopware.app.Application.addSubApplication({name:"Shopware.apps.MediaManager",layout:"small",forceToFront:d,selectionMode:"single",eventScope:c,mediaSelectionCallback:c._processImage})}),a.addButton("media_selection",{title:"Media Selection",cls:"tinymce-media-selection",cmd:"mceMediaSelection",image:b+"/icons/inbox-image.png"})},getInfo:function(){return{longname:"MediaManager - MediaSelection",author:"shopware AG - st.pohl",authorurl:"http://www.shopware.de",infourl:"http://wiki.shopware.de/",version:"1.0.0"}},_processImage:function(a){var f,g,b=this,c=b.ed,d=a.up("window"),e=d.down(".mediamanager-media-view");e="grid"===e.selectedLayout?e.dataView:e.cardContainer.getLayout().getActiveItem(),f=e.getSelectionModel(),g=f.getSelection(),Ext.each(g,function(a){var d=a.get("type");"VIDEO"===d?b._insertVideo(a):"IMAGE"===d?b._insertImage(a):"MUSIC"===d?b._insertAudio(a):b._insertLink(a),c.undoManager.add()}),d.destroy()},_insertImage:function(a){var e,f,b=this,c=b.ed,d=c.settings;return e=a.get("path"),f={"class":b.imageCls,width:a.get("width"),height:a.get("height"),alt:a.get("name"),src:e},c.execCommand("mceInsertContent",!1,tinymce.DOM.createHTML("img",f),{skip_undo:1}),!0},_insertLink:function(a){var d,b=this,c=b.ed;return d={"class":b.linkCls,href:a.get("path"),title:a.get("name"),target:"_blank"},c.execCommand("mceInsertContent",!1,tinymce.DOM.createHTML("a",d,a.get("name")),{skip_undo:1}),!0},_insertVideo:function(a){var d,b=this,c=b.ed;return d={"class":b.videoCls,width:320,height:240,src:c.settings.document_base_url+a.get("path"),controls:!0},c.execCommand("mceInsertContent",!1,tinymce.DOM.createHTML("video",d),{skip_undo:1}),!0},_insertAudio:function(a){var d,b=this,c=b.ed;return d={"class":b.audioCls,src:c.settings.document_base_url+a.get("path"),controls:!0},c.execCommand("mceInsertContent",!1,tinymce.DOM.createHTML("audio",d),{skip_undo:1}),!0}}),tinymce.PluginManager.add("media_selection",tinymce.plugins.MediaSelectionPlugin)})();